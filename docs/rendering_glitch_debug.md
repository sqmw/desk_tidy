# Release 版本显示异常调试记录

## 问题描述
在 `desk_tidy` 的安装包或 Release 编译版本中，用户反馈存在以下显示异常：
1. **背景透明/异常**：窗口背景显示为透明（查看桌面）或出现“Acrylic background abnormal”提示。
2. **界面挤压 (UI Squashing)**：UI 内容变成窄窄的长条，无法填满窗口，甚至出现内容重叠。
3. **状态不一致**：最大化窗口时显示恢复正常，但缩小或重新通过快捷键/热区唤醒后，异常再次出现。

## 排查过程

### 1. 独立运行验证
通过将 `desk_tidy_box` 隔离到 `box/` 子目录，排除了 DLL 冲突和数据目录竞争的可能性。

### 2. 窗口参数分析
我们尝试了“安全模式”构建（带标题栏、固定尺寸、不透明背景）：
- **发现**：即使在标准窗口下，由于 `window_manager` 的尺寸初始化与 Windows 的 `DPI Awareness` 在 Release 模式下的响应速度差异，可能导致 Flutter View 的宽度计算错误。
- **触发点**：热区唤醒和快捷键唤回频繁触发窗口的 `restore()` 和 `setSize()`，在异步执行过程中产生了竞争。

### 3. 环境同步 (FVM)
由于 Dart SDK 约束 (`^3.8.1`) 与本地 Flutter 环境 (`3.38.5`) 可能存在的微小差异，我们通过 FVM 强制对齐到了 `3.38.7` 稳定版本，并执行了彻底的 `flutter clean`。

## 解决方案建议
- **清理与重构**：每次环境变动后必须执行 `fvm flutter clean`。
- **防止进程锁**：LNK1104 错误通常是由于旧版本程序未退出导致，编译前应使用 `taskkill` 确保环境干净。
- **窗口初始化顺序**：原生层面的窗口创建参数对 Release 渲染至关重要。

## 后续观察
- 如果 3.38.7 仍无法解决挤压问题，建议研究 `windows/runner/win32_window.cpp` 中的 `WM_SIZE` 消息处理流程，确保 Flutter View(HWND) 在父窗口 resize 后能立即获得正确的尺寸通知。
