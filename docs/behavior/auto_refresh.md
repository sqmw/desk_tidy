# 桌面图标自动更新（Auto Refresh）策略

## 背景
“桌面图标自动更新”会周期性触发快捷方式扫描与图标补齐。该过程可能启动 isolate，并带来额外 CPU 开销，因此默认关闭且不建议开启。

## 当前策略（2026-02-03）
1. **不在后台扫描**
   - 当窗口被隐藏到托盘（未显示主窗口）时，不启动/不执行自动刷新扫描。
2. **仅在“应用”页工作**
   - 自动刷新仅在主窗口显示且当前 Tab 为“应用”时启用定时器。
3. **避免无意义的全量扫描**
   - 定时器每次 tick 先进行“仅桌面范围”的轻量探测；
   - 只有探测到桌面快捷方式列表发生变化时，才触发一次完整的快捷方式刷新（并尽量复用已探测到的桌面扫描结果）。

## 触发时机
- **App 进程启动**：不再在后台自动执行快捷方式扫描。
- **窗口被显示（从托盘/热键/热区唤起等）**：
  - 会触发一次桌面变化探测；如有变化则刷新快捷方式列表。
- **切换到“应用”Tab**：
  - 仍会触发一次快捷方式刷新（用于确保应用列表在用户查看时是最新的）。
- **切换离开“应用”Tab**：
  - 会立即取消正在进行的应用列表刷新（只保留最后一次 Tab 选择的结果），避免来回切换导致后台仍在做无意义工作。

## 代码入口
- 自动刷新定时与探测：`lib/screens/desk_tidy_home/logic_search.dart`
- 快捷方式扫描与图标补齐：`lib/screens/desk_tidy_home/categories/shortcut_loading.dart`
- 托盘显示/隐藏生命周期：`lib/screens/desk_tidy_home/logic_bootstrap.dart`、`lib/screens/desk_tidy_home/logic_runtime.dart`

## 手动验证
1. 启动应用后保持在托盘：观察 CPU 占用应保持稳定（不会周期性扫描）。
2. 打开主窗口，进入“应用”页：
   - 若桌面快捷方式有变化，列表会在短时间内更新；
   - 若无变化，不应频繁触发全量刷新。
3. 切换到“设置”页：自动刷新应停止（不会继续扫描）。
